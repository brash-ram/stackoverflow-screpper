name: bot CI/CD

on:
    push:
        paths:
            - 'bot/**'

env:
    REGISTRY: ghcr.io
    IMAGE_NAME: bot_app
    AUTHOR: brash-ram

jobs:
    build:

        runs-on: ubuntu-latest

        steps:
            -   uses: actions/checkout@v3
            -   name: Set up JDK 17
                uses: actions/setup-java@v3
                with:
                    java-version: '17'
                    distribution: 'temurin'
                    cache: maven
            -   name: Build with Maven
                run: mvn package -pl bot -am

            -   name: Log in to the Container registry
                uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
                with:
                    registry: ${{ env.REGISTRY }}
                    username: ${{ env.AUTHOR }}
                    password: ${{ secrets.GIT_TOKEN }}

            -   name: Build Docker image
                run: docker build -f ./bot/Dockerfile -t ${{ env.REGISTRY}}/${{ env.AUTHOR }}/${{ env.IMAGE_NAME }}:latest .

            -   name: Push Docker image
                run: docker push ${{ env.REGISTRY}}/${{ env.AUTHOR }}/${{ env.IMAGE_NAME }}:latest
    checkstyle:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout code
                uses: actions/checkout@v3

            -   name: Set up JDK 17
                uses: actions/setup-java@v3
                with:
                    java-version: '17'
                    distribution: 'temurin'
                    cache: maven

            -   name: Prepare checkstyle
                run: mvn clean install

            -   name: Run Checkstyle
                run: mvn -pl bot -am checkstyle:check
